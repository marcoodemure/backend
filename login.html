<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Habi't Likha - Flea Market</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<h1>Flea Market</h1>

<nav id="nav">
  <a href="login.html" id="loginLink">Login</a> |
  <a href="cart.html">Cart</a> |
  <a href="orders.html">Orders</a> |
  <button id="logoutBtn" style="display:none">Logout</button>
  <span id="userEmail"></span>
</nav>

<div id="products"></div>

<script type="module">
import { products } from "./js/products.js";
import { addToCart, handleLogout, autoAddFromURL } from "./js/cart.js";
import { auth } from "./js/firebase.js";
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const container = document.getElementById("products");
const logoutBtn = document.getElementById("logoutBtn");
const loginLink = document.getElementById("loginLink");
const userEmailSpan = document.getElementById("userEmail");

logoutBtn.onclick = handleLogout;

// Show products dynamically
products.forEach(p => {
  const div = document.createElement("div");
  div.className = "product";
  div.innerHTML = `
    <h3>${p.name}</h3>
    <p>Price: $${p.price}</p>
    <button>Add to Cart</button>
  `;
  const btn = div.querySelector("button");
  btn.addEventListener("click", () => addToCart(p.id));
  container.appendChild(div);
});

// Track login state
onAuthStateChanged(auth, user => {
  if (user) {
    logoutBtn.style.display = "inline-block";
    loginLink.style.display = "none";
    userEmailSpan.textContent = `Logged in as: ${user.email}`;
  } else {
    logoutBtn.style.display = "none";
    loginLink.style.display = "inline-block";
    userEmailSpan.textContent = "";
  }
});

// Auto add from URL (Google Sites integration)
autoAddFromURL();
</script>

</body>
</html>
